<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=description content=最近D言語を書いていない。というかプログラミングらしいことをしていない。さらに今使っているコンピュータにはDMDがインストールされてすらいない。><link rel=stylesheet href=https://blog.kotet.jp/sass/single.min.a3a5f142e959ac87355788d7b927889cb2cc8ce1e9d56b8fb03506a4406e4414.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/d.min.js></script><script>hljs.initHighlightingOnLoad();</script><script defer src="//cdn.rawgit.com/mathjax/MathJax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type=text/javascript></script><script type=text/x-mathjax-config>
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        displayMath: [['$$','$$']],
        processEscapes: true
      }
    });
</script><title>#dlang DMDとDUBをソースからインストールする - Kotet&#39;s Personal Blog</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel=canonical href=https://blog.kotet.jp/2017/12/d-from-source/><link rel=icon href=/favicon.ico><meta name=twitter:card content=summary><meta name=og:title content="#dlang DMDとDUBをソースからインストールする - Kotet's Personal Blog"><meta name=og:description content=最近D言語を書いていない。というかプログラミングらしいことをしていない。さらに今使っているコンピュータにはDMDがインストールされてすらいない。><meta name=twitter:image content=https://blog.kotet.jp/assets/logo.png><meta name=twitter:url content=https://blog.kotet.jp/2017/12/d-from-source/><meta name=twitter:site content=@kotetttt><meta name=twitter:creator content=@kotetttt><meta name=generator content="Hugo 0.51"><script defer src="//www.googletagmanager.com/gtag/js?id=UA-88180620-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-88180620-1');</script><script async src=//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><script>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:"ca-pub-8443812672116269",enable_page_level_ads:true});</script></head><body><header class=site><nav><ul><li><a href=/about>ABOUT</a></li><li><a href=/products>PRODUCTS</a></li><li><a href=/tags>TAGS</a></li><li><a href=/index.xml>FEED</a></li></ul></nav><h1><a href=/>KOTET'S PERSONAL BLOG</a></h1></header><main><header><h2><a href=/tags/dlang>#dlang</a>
DMDとDUBをソースからインストールする</h2><p><time>2017-12-04</time>
<a href=/tags/dlang>#dlang</a> <a href=/tags/log>#log</a> <a href=/tags/tech>#tech</a></p><aside><p>Table of Contents</p><nav id=TableOfContents><ul><li><ul><li><ul><li><a href=#dmd>DMD</a><ul><li><a href=#ソースのダウンロード>ソースのダウンロード</a></li><li><a href=#dmdのビルド>DMDのビルド</a></li><li><a href=#その他のビルド>その他のビルド</a></li><li><a href=#動作確認>動作確認</a></li><li><a href=#インストール>インストール</a></li></ul></li><li><a href=#dub>DUB</a><ul><li><a href=#ビルド>ビルド</a></li><li><a href=#インストール-1>インストール</a></li><li><a href=#動作確認-1>動作確認</a></li></ul></li><li><a href=#最新版のビルド>最新版のビルド</a><ul><li><a href=#dmd-1>DMD</a></li><li><a href=#dub-1>DUB</a></li></ul></li></ul></li></ul></li></ul></nav></aside></header><article><p>最近D言語を書いていない。
というかプログラミングらしいことをしていない。
さらに今使っているコンピュータにはDMDがインストールされてすらいない。</p><p>以前いろいろと前提となる基礎知識が欠けていてDMDのソースからのインストールができなかったのを思い出したので、とりあえずDMDのビルドをしようと思った。
<a href=https://qiita.com/advent-calendar/2017/dlang>D言語 Advent Calendar 2017</a>の4日目のこの記事はその時の記録である。</p><p>出力はその場の気分で省略したりしなかったりしてある。
ものすごくのんびりやったため実際の作業は数日にわかれている。</p><p><code>v2.077.0</code>と最新版をインストールしたのだが、思っていたよりも遥かに簡単で時間もかからなかった。
速すぎて冬場の暖房には使えないかもしれない。</p><h3 id=dmd>DMD</h3><h4 id=ソースのダウンロード>ソースのダウンロード</h4><p>まずはソースをダウンロードしてくる。
最初は最新版ではなくバージョンを<code>v2.077.0</code>に指定してやってみようと思う。</p><pre><code class=language-console>~$ mkdir src/dlang-v2.077.0
~$ cd src/dlang-v2.077.0/
~/src/dlang-v2.077.0$ git clone -b v2.077.0 https://github.com/dlang/dmd
~/src/dlang-v2.077.0$ git clone -b v2.077.0 https://github.com/dlang/druntime
~/src/dlang-v2.077.0$ git clone -b v2.077.0 https://github.com/dlang/phobos
~/src/dlang-v2.077.0$ git clone -b v2.077.0 https://github.com/dlang/tools
</code></pre><h4 id=dmdのビルド>DMDのビルド</h4><p>ある一定以上バージョンが上のDMDのビルドにはDMDが必要なので、
古いバージョンのDMDを自分でビルドするか、バイナリをダウンロードしてくる必要がある。
……と思っていたのだが、どうもそのあたりも<a href=https://wiki.dlang.org/Building_under_Posix#Bootstrap_dmd>自分でやってくれる</a>らしい。
もちろんPATHの通ったDMDがすでにあるならそちらを使ってビルドを高速化できる。
しかしそんなことをしなくても割とあっという間に終わった。</p><pre><code class=language-console>~/src/dlang-v2.077.0/dmd$ make -f posix.mak -j8 AUTO_BOOTSTRAP=1
</code></pre><pre><code class=language-console>~/src/dlang-v2.077.0/dmd$ ./generated/linux/release/64/dmd --version
DMD64 D Compiler v2.077.0
Copyright (c) 1999-2017 by Digital Mars written by Walter Bright
</code></pre><h4 id=その他のビルド>その他のビルド</h4><p>標準ライブラリのphobosをビルドする。
PATHを通していないのに<code>../dmd/generated/linux/release/64/dmd</code>を使ってくれる。
しかも<code>druntime</code>もいっしょにビルドされている。</p><pre><code class=language-console>~/src/dlang-v2.077.0$ cd phobos/
~/src/dlang-v2.077.0/phobos$ make -f posix.mak -j8
</code></pre><pre><code class=language-console>~/src/dlang-v2.077.0$ tree phobos/generated/
phobos/generated/
└── linux
    └── release
        └── 64
            ├── etc
            │   └── c
            │       └── zlib
            │           ├── adler32.o
            │           ├── compress.o
            │           ├── crc32.o
            │           ├── deflate.o
            │           ├── gzclose.o
            │           ├── gzlib.o
            │           ├── gzread.o
            │           ├── gzwrite.o
            │           ├── infback.o
            │           ├── inffast.o
            │           ├── inflate.o
            │           ├── inftrees.o
            │           ├── trees.o
            │           ├── uncompr.o
            │           └── zutil.o
            ├── libphobos2.a
            ├── libphobos2.so -&gt; libphobos2.so.0.77.0
            ├── libphobos2.so.0.77 -&gt; libphobos2.so.0.77.0
            ├── libphobos2.so.0.77.0
            └── libphobos2.so.0.77.o

6 directories, 20 files
~/src/dlang-v2.077.0$ tree druntime/generated/
druntime/generated/
└── linux
    └── release
        └── 64
            ├── bss_section.o
            ├── errno_c.o
            ├── libdruntime.a
            ├── libdruntime.so.a
            ├── libdruntime.so.o
            └── threadasm.o

3 directories, 6 files
</code></pre><h4 id=動作確認>動作確認</h4><p><code>static foreach</code>を使ったことがないので試してみる。</p><pre><code class=language-d>/// test.d

import std.stdio;

static foreach(i;0..10)
{
    pragma(msg,i);
}

void main()
{
    writeln(&quot;hello&quot;);
}
</code></pre><pre><code class=language-console>~/src/dlang-v2.077.0$ dmd/generated/linux/release/64/dmd test.d
0
1
2
3
4
5
6
7
8
9
~/src/dlang-v2.077.0$ ./test 
hello
</code></pre><p>ちゃんと動いた。</p><h4 id=インストール>インストール</h4><p>適当な場所に置く。</p><pre><code class=language-console>~/src/dlang-v2.077.0$ ln -s ~/src/dlang-v2.077.0/dmd/generated/linux/release/64/dmd ~/bin/ # ~/bin はPATHを通してあるディレクトリ
</code></pre><pre><code class=language-console>~/src/dlang-v2.077.0$ which dmd
/home/kotet/bin/dmd
</code></pre><p>というわけで、これでDMD 2.077.0のインストールが完了した。
思っていたよりも短い時間でできてびっくりした。</p><h3 id=dub>DUB</h3><p>せっかくなのでこの調子でDUBもインストールする。</p><h4 id=ビルド>ビルド</h4><p>DMDとlibcurlが必要らしいが両方あるのでそのまま<code>build.sh</code>を実行する。</p><pre><code class=language-console>~/src$ git clone -b v1.6.0 https://github.com/dlang/dub.git dub-v1.6.0
~/src$ cd dub-v1.6.0/
~/src/dub-v1.6.0$ ./build.sh 
Generating version file...
Running dmd...
source/dub/internal/sdlang/token.d(26): Deprecation: struct core.time.FracSec is deprecated - FracSec has been deprecated in favor of just using Duration for the sake of simplicity
source/dub/internal/sdlang/token.d(26): Deprecation: struct core.time.FracSec is deprecated - FracSec has been deprecated in favor of just using Duration for the sake of simplicity
DUB version 1.6.0, built on Nov 15 2017
DUB has been built as bin/dub.

You may want to run
sudo ln -s /home/kotet/src/dub-v1.6.0/bin/dub /usr/local/bin
now.
</code></pre><h4 id=インストール-1>インストール</h4><p><code>/usr/local/bin</code>へのインストールをおすすめされているが今回は<code>~/bin</code>にした。</p><pre><code class=language-console>~/src/dub-v1.6.0$ ln -s /home/kotet/src/dub-v1.6.0/bin/dub ~/bin
</code></pre><pre><code class=language-console>~/src/dub-v1.6.0$ which dub
/home/kotet/bin/dub
~/src/dub-v1.6.0$ dub --version
DUB version 1.6.0, built on Nov 15 2017
</code></pre><h4 id=動作確認-1>動作確認</h4><p><a href=https://qiita.com/lempiji/items/03629cd46fcbd948ca41>D言語くんが走りだす</a>。</p><pre><code class=language-console>~$ dub fetch dl
Fetching dl 1.0.1...
Please note that you need to use `dub run &lt;pkgname&gt;` or add it to dependencies of your package to actually use/run it. dub does not do actual installation of packages outside of its own ecosystem.
~$ dub run dl
Building package dl in /home/kotet/.dub/packages/dl-1.0.1/dl/
Performing &quot;debug&quot; build using dmd for x86_64.
dl 1.0.1: building configuration &quot;executable&quot;...
Linking...
Running .dub/packages/dl-1.0.1/dl/dl 



  _   _
 (_) (_)
/______ \
\\(O(O \/
 | | | |
 | |_| |
/______/
  &lt;   &gt;
 (_) (_)
</code></pre><p>というわけでD言語の基本的なツールがインストールできた。
想像以上に簡単だった。
やはり何事もやってみることが大事ということだ。</p><h3 id=最新版のビルド>最新版のビルド</h3><p>せっかくなので最新版もビルドしてみる。
全く同じようにインストールを行える。</p><h4 id=dmd-1>DMD</h4><p>同じようにダウンロード。</p><pre><code class=language-console>~/src$ mkdir dlang-$(date -I)
~/src$ ls
dlang-2017-11-22  dlang-v2.077.0  dub-v1.6.0
~/src$ cd dlang-2017-11-22/
~/src/dlang-2017-11-22$ git clone https://github.com/dlang/dmd
~/src/dlang-2017-11-22$ git clone https://github.com/dlang/druntime
~/src/dlang-2017-11-22$ git clone https://github.com/dlang/phobos
~/src/dlang-2017-11-22$ git clone https://github.com/dlang/tools
</code></pre><p>すでにDMDをインストール済みなのでそれを使ってくれる。</p><pre><code class=language-console>~/src/dlang-2017-11-22/dmd$ make -f posix.mak -j8
</code></pre><pre><code class=language-console>~/src/dlang-2017-11-22/dmd$ ./generated/linux/release/64/dmd --version
DMD64 D Compiler v2.077.0-251-g46fc949
Copyright (c) 1999-2017 by Digital Mars written by Walter Bright
</code></pre><p>続けてPhobos等のビルド。</p><pre><code class=language-console>~/src/dlang-2017-11-22/dmd$ cd ../phobos/
~/src/dlang-2017-11-22/phobos$ make -f posix.mak -j8
</code></pre><p>インストール。</p><pre><code class=language-console>~/src/dlang-2017-11-22/phobos$ ln -s ~/src/dlang-2017-11-22/dmd/generated/linux/release/64/dmd ~/bin/dmd-latest
</code></pre><p>動作確認。</p><pre><code class=language-console>~$ which dmd-latest
/home/kotet/bin/dmd-latest
~$ dmd-latest --version
DMD64 D Compiler v2.077.0-251-g46fc949
Copyright (c) 1999-2017 by Digital Mars written by Walter Bright
~$ dmd-latest test.d
0
1
2
3
4
5
6
7
8
9
~$ ./test
hello
</code></pre><p>ちゃんと最新版の方のPhobosが使われているか確認するのを忘れていた。</p><pre><code class=language-console>~$ dmd-latest --help
DMD64 D Compiler v2.077.0-251-g46fc949
Copyright (c) 1999-2017 by Digital Mars written by Walter Bright

Documentation: http://dlang.org/
Config file: /home/kotet/src/dlang-2017-11-22/dmd/generated/linux/release/64/dmd.conf
...
$ cat /home/kotet/src/dlang-2017-11-22/dmd/generated/linux/release/64/dmd.conf
[Environment32]
DFLAGS=-I%@P%/../../../../../druntime/import -I%@P%/../../../../../phobos -L-L%@P%/../../../../../phobos/generated/linux/release/32 -L--export-dynamic

[Environment64]
DFLAGS=-I%@P%/../../../../../druntime/import -I%@P%/../../../../../phobos -L-L%@P%/../../../../../phobos/generated/linux/release/64 -L--export-dynamic -fPIC
$ readlink -f /home/kotet/src/dlang-2017-11-22/dmd/generated/linux/release/64/../../../../../phobos/generated/linux/release/64
/home/kotet/src/dlang-2017-11-22/phobos/generated/linux/release/64
</code></pre><p>大丈夫そう。</p><h4 id=dub-1>DUB</h4><p>せっかくなので先ほどの最新版を使ってビルドする。</p><pre><code class=language-console>~/src$ git clone https://github.com/dlang/dub.git dub-$(date -I)
~/src$ cd dub-2017-11-22/
~/src/dub-2017-11-22$ DMD=&quot;dmd-latest&quot; ./build.sh
Generating version file...
Running dmd-latest...
source/dub/internal/sdlang/token.d(26): Deprecation: struct core.time.FracSec is deprecated - FracSec has been deprecated in favor of just using Duration for the sake of simplicity
source/dub/internal/sdlang/token.d(26): Deprecation: struct core.time.FracSec is deprecated - FracSec has been deprecated in favor of just using Duration for the sake of simplicity
DUB version 1.6.0+28-gf7d620b, built on Nov 22 2017
DUB has been built as bin/dub.

You may want to run
sudo ln -s /home/kotet/src/dub-2017-11-22/bin/dub /usr/local/bin
now.
~/src/dub-2017-11-22$ ln -s /home/kotet/src/dub-2017-11-22/bin/dub ~/bin/dub-latest
</code></pre><p>動作確認。</p><pre><code class=language-console>~$ which dub-latest 
/home/kotet/bin/dub-latest
~$ dub-latest --version
DUB version 1.6.0+28-gf7d620b, built on Nov 22 2017
~$ dub-latest fetch dl
Please note that you need to use `dub run &lt;pkgname&gt;` or add it to dependencies of your package to actually use/run it. dub does not do actual installation of packages outside of its own ecosystem.
~$ dub-latest run dl
Building package dl in /home/kotet/.dub/packages/dl-1.0.1/dl/
Performing &quot;debug&quot; build using dmd for x86_64.
dl 1.0.1: target for configuration &quot;executable&quot; is up to date.
To force a rebuild of up-to-date targets, run again with --force.
Running .dub/packages/dl-1.0.1/dl/dl 



  _   _
 (_) (_)
/______ \
\\(O(O \/
 | | | |
 | |_| |
/______/
  &lt;   &gt;
 (_) (_)

</code></pre></article><footer><h2><a href=/tags/dlang>#dlang</a>
DMDとDUBをソースからインストールする</h2><p><time>2017-12-04</time>
<a href=/tags/dlang>#dlang</a> <a href=/tags/log>#log</a> <a href=/tags/tech>#tech</a></p></footer><div class=ad-wrapper><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-8443812672116269 data-ad-slot=2914874272 data-ad-format=horizontal data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div></main><footer class=site></footer></body></html>