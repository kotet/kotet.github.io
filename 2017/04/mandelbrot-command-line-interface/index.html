<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=description content="なにか計算的なことをやってみたくてマンデルブロ集合を書く。 「描く」ではなく「書く」なのはコマンドライン上に文字で表現するからである。 マンデル"><link rel=stylesheet href=https://blog.kotet.jp/sass/single.min.3eeaf6ed1df267da88773748526a6bec7420ca30786c65a9be234645937d638d.css><script defer src="//cdn.rawgit.com/mathjax/MathJax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type=text/javascript></script><script type=text/x-mathjax-config>
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        displayMath: [['$$','$$']],
        processEscapes: true
      }
    });
</script><title>#dlang Dでマンデルブロ集合を書く - Kotet&#39;s Personal Blog</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel=canonical href=https://blog.kotet.jp/2017/04/mandelbrot-command-line-interface/><link rel=icon href=/favicon.ico><meta name=twitter:card content=summary><meta name=og:title content="#dlang Dでマンデルブロ集合を書く - Kotet's Personal Blog"><meta name=og:description content="なにか計算的なことをやってみたくてマンデルブロ集合を書く。 「描く」ではなく「書く」なのはコマンドライン上に文字で表現するからである。 マンデル"><meta name=og:image content=https://blog.kotet.jp2017/04/12/twitter.png><meta name=twitter:url content=https://blog.kotet.jp/2017/04/mandelbrot-command-line-interface/><meta name=twitter:site content=@kotetttt><meta name=twitter:creator content=@kotetttt><meta name=generator content="Hugo 0.49"><script defer src="//www.googletagmanager.com/gtag/js?id=UA-88180620-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-88180620-1');</script><script async src=//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><script>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:"ca-pub-8443812672116269",enable_page_level_ads:true});</script></head><body><header class=site><nav><ul><li><a href=/about>ABOUT</a></li><li><a href=/products>PRODUCTS</a></li><li><a href=/tags>TAGS</a></li><li><a href=/index.xml>FEED</a></li></ul></nav><h1><a href=/>KOTET'S PERSONAL BLOG</a></h1></header><main><header><h2><a href=/tags/dlang>#dlang</a>
Dでマンデルブロ集合を書く</h2><p><time>2017-04-12</time>
<a href=/tags/dlang>#dlang</a> <a href=/tags/tech>#tech</a></p><aside><p>Table of Contents</p><nav id=TableOfContents><ul><li><ul><li><ul><li><a href=#マンデルブロ集合とは>マンデルブロ集合とは</a></li></ul></li></ul></li></ul></nav></aside></header><article><p><img src=/assets/2017/04/12/mandel.png alt=書いたマンデルブロー集合></p><p>なにか計算的なことをやってみたくてマンデルブロ集合を書く。
「描く」ではなく「書く」なのはコマンドライン上に文字で表現するからである。</p><h3 id=マンデルブロ集合とは>マンデルブロ集合とは</h3><p>いろいろなサイトで出尽くしているけど一応書く。</p><p>\(z_{n+1}=z_n^2+c\)<br>\(z_1=0\)</p><p>という漸化式が\(x \to \infty\)の極限で無限大に発散しない\(c\)の集合がマンデルブロ集合である。
つまり一つ一つ\(c\)を設定して発散しないか確かめて、それをプロットしていけばいい。
いろいろあって一度\(|z_n|&gt;2\)になると発散するので、適当にnを増やしていって判定する。
一度も絶対値が2を超えなければ塗って、どこかで2を超えたら塗らない。
場合によっては発散したところにも2を始めに超えた時のnで色分けしたりする。
言語によっては実部と虚部を分けて実数計算に直したりするそうだが、Dには<code>std.complex</code>という複素数を表現できる
標準ライブラリがある。とてもつよい。</p><p><a href=https://github.com/kotet/mandelbrot-cli>kotet/mandelbrot-cli</a></p><p>そういうわけでできたものがコチラである。<code>dub run -- --row 100 --column 400</code>で上の出力が得られる。
文字で表現する程度のサイズだと一瞬で終わってしまうので、次は画像、動画を生成したい。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-d data-lang=d>import std.complex;

void main(string[] args)
{
	import std.getopt : defaultGetoptPrinter, getopt, GetOptException,
		GetoptResult;
	import std.stdio : writeln;

	real top = 1.0;
	real left = -2.0;
	real height = 2.0;
	real width = 4.0;
	size_t row = 20;
	size_t column = 80;
	size_t judge_iter = 20;

	GetoptResult helpinfo;
	try
	{
		helpinfo = getopt(args, &#34;top&#34;, &amp;top, &#34;left&#34;, &amp;left, &#34;height&#34;,
				&amp;height, &#34;width&#34;, &amp;width, &#34;row&#34;, &amp;row, &#34;column&#34;, &amp;column,
				&#34;judge-iter&#34;, &amp;judge_iter);
	}
	catch (Exception e)
	{
		writeln(&#34;Error: &#34;, e.msg, &#34;\nexit&#34;);
		return;
	}

	if (helpinfo.helpWanted)
		defaultGetoptPrinter(&#34;test&#34;, helpinfo.options);

	draw(top, left, height, width, row, column, judge_iter).writeln;
}

string draw(real top, real left, real height, real width, size_t row,
		size_t column, size_t judge_iter)
{
	string result;
	foreach (ro; 0 .. row)
	{
		foreach (co; 0 .. column)
		{
			// z(n+1) = z(n) ^ 2 + c; z(0) = 0
			Complex!real c;
			c.im = top - height * (cast(real) ro / row);
			c.re = left + width * (cast(real) co / column);
			if (isDiverge(c, judge_iter))
			{
				result ~= &#39; &#39;;
			}
			else
			{
				result ~= &#39;#&#39;;
			}
		}
		result ~= &#39;\n&#39;;
	}
	return result;
}

bool isDiverge(Complex!real c, size_t judge_iter)
{
	auto z = complex!real(0, 0);

	foreach (i; 0 .. judge_iter)
	{
		z = z * z + c;
		if (2.0 &lt; z.abs)
			return true;
	}
	return false;
}</code></pre></div></article><footer><h2><a href=/tags/dlang>#dlang</a>
Dでマンデルブロ集合を書く</h2><p><time>2017-04-12</time>
<a href=/tags/dlang>#dlang</a> <a href=/tags/tech>#tech</a></p></footer><div class=ad-wrapper><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-8443812672116269 data-ad-slot=2914874272 data-ad-format=horizontal data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div></main><footer class=site></footer></body></html>