<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=description content="どうも数式表示のために読み込ませていたMathJaxのCDNである `cdn.mathjax.org`が今年の4月30日でシャットダウンされていたようだ。 しかしどうもMathJaxは変わらず数式をレンダリングし続けてくれているように見える。"><link rel=stylesheet href=https://blog.kotet.jp/sass/single.min.de28e1c7c877cf440b6a52e3e8b5f74662b06e59118c733f331f2b91331dfc39.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/d.min.js></script><script>hljs.initHighlightingOnLoad();</script><script defer src="//cdn.rawgit.com/mathjax/MathJax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type=text/javascript></script><script type=text/x-mathjax-config>
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        displayMath: [['$$','$$']],
        processEscapes: true
      }
    });
</script><title>#jekyll MathJaxのCDNが警告を発しつつも使えてしまっていた - Kotet&#39;s Personal Blog</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel=canonical href=https://blog.kotet.jp/2017/07/fix-mathjax-cdn/><link rel=icon href=/favicon.ico><meta name=twitter:card content=summary><meta name=og:title content="#jekyll MathJaxのCDNが警告を発しつつも使えてしまっていた - Kotet's Personal Blog"><meta name=og:description content="どうも数式表示のために読み込ませていたMathJaxのCDNである `cdn.mathjax.org`が今年の4月30日でシャットダウンされていたようだ。 しかしどうもMathJaxは変わらず数式をレンダリングし続けてくれているように見える。"><meta name=og:image content=https://blog.kotet.jp2017/07/06/twitter.png><meta name=twitter:url content=https://blog.kotet.jp/2017/07/fix-mathjax-cdn/><meta name=twitter:site content=@kotetttt><meta name=twitter:creator content=@kotetttt><meta name=generator content="Hugo 0.52"><script defer src="//www.googletagmanager.com/gtag/js?id=UA-88180620-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-88180620-1');</script><script async src=//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><script>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:"ca-pub-8443812672116269",enable_page_level_ads:true});</script></head><body><header class=site><nav><ul><li><a href=/about>ABOUT</a></li><li><a href=/products>PRODUCTS</a></li><li><a href=/tags>TAGS</a></li><li><a href=/index.xml>FEED</a></li></ul></nav><h1><a href=/>KOTET'S<br>PERSONAL<br>BLOG</a></h1></header><main><header><h2><a href=/tags/jekyll>#jekyll</a>
MathJaxのCDNが警告を発しつつも使えてしまっていた</h2><p><time>2017-07-06</time>
<a href=/tags/jekyll>#jekyll</a> <a href=/tags/tech>#tech</a> <a href=/tags/github>#github</a></p><aside><p>Table of Contents</p></aside></header><article><p>生成されているHTMLを確認しようとChrome DevToolsを開いたところ、なにかWarningが出ていた。</p><p><img src=/assets/2017/07/06/warning.png alt=warning></p><p>どうも数式表示のために読み込ませていたMathJaxのCDNである
<code>cdn.mathjax.org</code>が今年の4月30日でシャットダウンされていたようだ。</p><p><a href=https://www.mathjax.org/cdn-shutting-down/>MathJax CDN shutting down on April 30, 2017. Alternatives available.</a></p><p>しかしどうもMathJaxは変わらず数式をレンダリングし続けてくれているように見える。
なぜだろう?と思って更に読み込んだところ上のページに追記があった。</p><blockquote><p><strong>Temporary redirect starting May 1, 2017</strong></p><p><strong>[Updated 2017/04/10]</strong></p><p>We will implement a temporary redirect on cdn.mathjax.org to redirect users to cdnjs.</p></blockquote><p>いままでこのサイトで読み込まれていた<a href=https://cdn.mathjax.org/mathjax/2.7-latest/MathJax.js>https://cdn.mathjax.org/mathjax/2.7-latest/MathJax.js</a>
を見てみると、なるほど確かにリダイレクト用に新しいCDNに<code>script</code>タグを置き換えるスクリプトになっている。</p><pre><code class=language-javascript>(function () {
  var newMathJax = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js';
  var oldMathJax = 'cdn.mathjax.org/mathjax/2.7-latest/MathJax.js';

  var replaceScript = function (script, src) {
    //
    //  Make redirected script
    //
    var newScript = document.createElement('script');
    newScript.src = newMathJax + src.replace(/.*?(\?|$)/, '$1');
    //
    //  Move onload and onerror handlers to new script
    //
    newScript.onload = script.onload; 
    newScript.onerror = script.onerror;
    script.onload = script.onerror = null;
    //
    //  Move any content (old-style configuration scripts)
    //
    while (script.firstChild) newScript.appendChild(script.firstChild);
    //
    //  Copy script id
    //
    if (script.id != null) newScript.id = script.id;
    //
    //  Replace original script with new one
    //
    script.parentNode.replaceChild(newScript, script);
    //
    //  Issue a console warning
    //
    console.warn('WARNING: cdn.mathjax.org has been retired. Check https://www.mathjax.org/cdn-shutting-down/ for migration tips.')
  }

  if (document.currentScript) {
    var script = document.currentScript;
    replaceScript(script, script.src);
  } else {
    //
    // Look for current script by searching for one with the right source
    //
    var n = oldMathJax.length;
    var scripts = document.getElementsByTagName('script');
    for (var i = 0; i &lt; scripts.length; i++) {
      var script = scripts[i];
      var src = (script.src || '').replace(/.*?:\/\//,'');
      if (src.substr(0, n) === oldMathJax) {
        replaceScript(script, src);
        break;
      }
    }
  }
})();
</code></pre><p>MathJaxそのものよりもサイズが減って負荷軽減になっている……のだろうか?
自分みたいな他のCDNに移行するのを忘れている人にはありがたいが、おかげでDevToolsを開くまで異変に気が付かなかった。
ちゃんと動かなくなってくれたほうがかえって良かったかもしれない。</p><p>とにかく気づいたのでURLを別のCDNプロバイダのものに変更して対処。</p><p><img src=/assets/2017/07/06/diff.png alt=diff></p><p><a href=https://github.com/kotet/kotet.github.io/commit/200f8505a938263e4b3f38cf47f85c66751f4587>Fix MathJax CDN · kotet/kotet.github.io@200f850</a></p><p>無事にMathJaxの警告はなくなった。</p></article><footer><h2><a href=/tags/jekyll>#jekyll</a>
MathJaxのCDNが警告を発しつつも使えてしまっていた</h2><p><time>2017-07-06</time>
<a href=/tags/jekyll>#jekyll</a> <a href=/tags/tech>#tech</a> <a href=/tags/github>#github</a></p></footer><div class=ad-wrapper><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-8443812672116269 data-ad-slot=2914874272 data-ad-format=horizontal data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div></main><footer class=site></footer></body></html>