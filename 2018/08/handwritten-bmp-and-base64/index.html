<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=description content="文名は容易に揚らず、生活リズムは日を逐うて崩れてゆく。 Kotetは漸く焦躁に駆られて来た。 この頃からその容貌も峭刻となり、肉落ち骨秀で、眼光"><link rel=stylesheet href=https://blog.kotet.jp/sass/single.min.02c91f0bdf54d569f6c715f0a345bf32b55cd4d3ac11e0b98fec7ad1e614c151.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/d.min.js></script><script>hljs.configure({languages:[]})
hljs.initHighlightingOnLoad();</script><script defer src="//cdn.rawgit.com/mathjax/MathJax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type=text/javascript></script><script type=text/x-mathjax-config>
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        displayMath: [['$$','$$']],
        processEscapes: true
      }
    });
</script><title>#tech 紙とペンでビットマップ画像を生成してbase64としてツイート - Kotet&#39;s Personal Blog</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel=canonical href=https://blog.kotet.jp/2018/08/handwritten-bmp-and-base64/><link rel=icon href=/favicon.ico><meta name=twitter:card content=summary><meta name=og:title content="#tech 紙とペンでビットマップ画像を生成してbase64としてツイート - Kotet's Personal Blog"><meta name=og:description content="文名は容易に揚らず、生活リズムは日を逐うて崩れてゆく。 Kotetは漸く焦躁に駆られて来た。 この頃からその容貌も峭刻となり、肉落ち骨秀で、眼光"><meta name=twitter:image content=https://blog.kotet.jp/img/common/logo.png><meta name=twitter:url content=https://blog.kotet.jp/2018/08/handwritten-bmp-and-base64/><meta name=twitter:site content=@kotetttt><meta name=twitter:creator content=@kotetttt><meta name=generator content="Hugo 0.55.2"><script defer src="//www.googletagmanager.com/gtag/js?id=UA-88180620-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-88180620-1');</script><script async src=//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><script>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:"ca-pub-8443812672116269",enable_page_level_ads:true});</script></head><body><header class=site><nav><ul><li><span class=text-up>ABOUT</span><a href=/about title=about><svg width="22" height="22" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><desc>Created with Sketch.</desc><defs/><g id="export" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="info" transform="translate(-1.000000, -1.000000)"><path id="placeholder" fill-opacity="0" fill="#fff" d="M0 0h24v24H0z"/><path d="M12 23C5.92486775 23 1 18.0751322 1 12 1 5.92486775 5.92486775 1 12 1 18.0751322 1 23 5.92486775 23 12 23 18.0751322 18.0751322 23 12 23zm0-2C16.9705627 21 21 16.9705627 21 12 21 7.02943725 16.9705627 3 12 3 7.02943725 3 3 7.02943725 3 12 3 16.9705627 7.02943725 21 12 21zM13.0036109 13.9983464H14.0029544v2h-4v-2h1v-2h-1V9.99834639h3.0006565V13.9983464zM12.0003283 8.99834639C11.4478622 8.99834639 11 8.55063114 11 7.99834639 11 7.44606164 11.4478622 6.99834639 12.0003283 6.99834639 12.5527943 6.99834639 13.0006565 7.44606164 13.0006565 7.99834639c0 .5522847500000001-.44786219999999943 1-1.0003282000000002 1z" id="Oval-17" fill="#000" fill-rule="nonzero"/></g></g></svg></a></li><li><span class=text-bottom>DOWNLOAD</span><a href=/products title=download><svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><desc>Created with Sketch.</desc><defs/><g id="export" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="download" transform="translate(-2.000000, -2.000000)"><path id="placeholder" fill-opacity="0" fill="#fff" d="M0 0h24v24H0z"/><path d="M22 16v4C22 21.1045695 21.1045695 22 20 22H4C2.8954305 22 2 21.1045695 2 20V16H4v4H20V16h2zm-9-3.4142136L16.2928932 9.29289322 17.7071068 10.7071068 12 16.4142136 6.29289322 10.7071068 7.70710678 9.29289322 11 12.5857864V2h2V12.5857864z" id="Combined-Shape" fill="#000"/></g></g></svg></a></li><li><span class=text-up>TAG</span><a href=/tags title=tag><svg width="22" height="14" viewBox="0 0 22 14" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><desc>Created with Sketch.</desc><defs/><g id="export" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="tag" transform="translate(-1.000000, -5.000000)"><path id="placeholder" fill-opacity="0" fill="#fff" d="M0 0h24v24H0z"/><path d="M6.53518376 5H21C22.1045695 5 23 5.8954305 23 7V17C23 18.1045695 22.1045695 19 21 19H6.53518376C5.86647738 19 5.24201473 18.6657977 4.87108317 18.1094004L1.16794971 12.5547002C.944016765 12.2188008.944016765 11.7811992 1.16794971 11.4452998L4.87108317 5.89059961C5.24201473 5.33420227 5.86647738 5 6.53518376 5zM3.20185043 12l3.33333333 5H21V7H6.53518376L3.20185043 12zM7 13C6.44771525 13 6 12.5522847 6 12 6 11.4477153 6.44771525 11 7 11 7.55228475 11 8 11.4477153 8 12 8 12.5522847 7.55228475 13 7 13z" id="Rectangle-29" fill="#000" fill-rule="nonzero"/></g></g></svg></a></li><li><span class=text-bottom>PODCAST</span><a href=https://podcast.kotet.jp title=podcast><svg width="22" height="20" viewBox="0 0 22 20" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><desc>Created with Sketch.</desc><defs/><g id="export" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="broadcasting" transform="translate(-1.000000, -2.000000)"><path id="placeholder" fill-opacity="0" fill="#fff" d="M0 0h24v24H0z"/><path d="M9.38742589 20 8.72075922 22H6.61257411L9.89881747 12.1412699C9.34410225 11.5968755 9 10.8386225 9 10 9 8.34314575 10.3431458 7 12 7 13.6568542 7 15 8.34314575 15 10 15 10.8386225 14.6558977 11.5968755 14.1011825 12.1412699L17.3874259 22H15.2792408L14.6125741 20H9.38742589zM10.7207592 16 10.0540926 18H13.9459074L13.2792408 16H10.7207592zM11.3874259 14H12.6125741L12.2750928 12.987556C12.1844984 12.9957918 12.0927406 13 12 13 11.9072594 13 11.8155016 12.9957918 11.7249072 12.987556L11.3874259 14zM12 11C12.5522847 11 13 10.5522847 13 10 13 9.44771525 12.5522847 9 12 9 11.4477153 9 11 9.44771525 11 10 11 10.5522847 11.4477153 11 12 11zm8.108743-8.43301443C21.9041909 4.52460368 23 7.13433188 23 10 23 12.8656681 21.9041909 15.4753963 20.108743 17.4330144L18.6344261 16.0815573C20.103429 14.4798697 21 12.3446376 21 10 21 7.65536245 20.103429 5.52013028 18.6344261 3.91844274L20.108743 2.56698557zM17.1601092 5.26989991C18.302667 6.51565689 19 8.17639301 19 10 19 11.823607 18.302667 13.4843431 17.1601092 14.7301001L15.6857923 13.3786429C16.501905 12.4888165 17 11.3025764 17 10 17 8.69742358 16.501905 7.51118349 15.6857923 6.62135708L17.1601092 5.26989991zM3.89125699 2.56665655 5.3655739 3.91811372C3.89657104 5.51980126 3 7.65503343 3 9.99967098 3 12.3443085 3.89657104 14.4795407 5.3655739 16.0812282L3.89125699 17.4326854C2.09580905 15.4750673 1 12.8653391 1 9.99967098 1 7.13400286 2.09580905 4.52427466 3.89125699 2.56665655zM6.83989081 5.26957089 8.31420772 6.62102806C7.49809502 7.51085447 7 8.69709456 7 9.99967098 7 11.3022474 7.49809502 12.4884875 8.31420772 13.3783139L6.83989081 14.7297711C5.69733303 13.4840141 5 11.823278 5 9.99967098 5 8.17606399 5.69733303 6.51532787 6.83989081 5.26957089z" id="Combined-Shape" fill="#000" fill-rule="nonzero"/></g></g></svg></a></li><li><span class=text-up>FEED</span><a href=/index.xml title=feed><svg width="22" height="18" viewBox="6 8 .5 10" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><desc>Created with Sketch.</desc><defs><path d="M1 21V19C2.1045695 19 3 19.8954305 3 21H1zm6 0H5C5 18.790861 3.209139 17 1 17V15C4.3137085 15 7 17.6862915 7 21zm4 0H9C9 16.581722 5.418278 13 1 13V11C6.5228475 11 11 15.4771525 11 21z" id="path-1"/></defs><g id="export" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="cast" transform="translate(-1.000000, -3.000000)"><path id="placeholder" fill-opacity="0" fill="#fff" d="M0 0h24v24H0z"/><mask id="mask-2" fill="#fff"><use xlink:href="#path-1"/></mask><use id="Combined-Shape" fill="#000" fill-rule="nonzero" xlink:href="#path-1"/></g></g></svg></a></li></ul></nav><h1><a href=/>KOTET'S<br>PERSONAL<br>BLOG</a></h1></header><main><header><h2><a href=/tags/tech>#tech</a>
紙とペンでビットマップ画像を生成してbase64としてツイート</h2><p><time>2018-08-21</time>
<a href=/tags/tech>#tech</a></p><aside><p>Table of Contents</p><nav id=TableOfContents><ul><li><ul><li><ul><li><a href=#ビットマップ画像を手書きしてツイートしよう>ビットマップ画像を手書きしてツイートしよう</a></li><li><a href=#ツイートできる最大サイズ>ツイートできる最大サイズ</a></li><li><a href=#画像の作成>画像の作成</a><ul><li><a href=#ファイルヘッダー>ファイルヘッダー</a><ul><li><a href=#ファイルタイプ>ファイルタイプ</a></li><li><a href=#ファイルサイズ>ファイルサイズ</a></li><li><a href=#予約領域>予約領域</a></li><li><a href=#画像データまでのオフセット>画像データまでのオフセット</a></li></ul></li><li><a href=#情報ヘッダー>情報ヘッダー</a><ul><li><a href=#情報ヘッダーのサイズ>情報ヘッダーのサイズ</a></li><li><a href=#画像サイズ>画像サイズ</a></li><li><a href=#プレーン数>プレーン数</a></li><li><a href=#色ビット数>色ビット数</a></li><li><a href=#圧縮形式>圧縮形式</a></li><li><a href=#その他>その他</a></li></ul></li><li><a href=#画像データ>画像データ</a></li></ul></li><li><a href=#base64でエンコード>base64でエンコード</a><ul><li><a href=#3バイトごとに区切る>3バイトごとに区切る</a></li><li><a href=#ブロックの変換>ブロックの変換</a></li><li><a href=#最後の処理>最後の処理</a></li></ul></li><li><a href=#完成-そしてツイート>完成、そしてツイート</a></li><li><a href=#参考>参考</a></li></ul></li></ul></li></ul></nav></aside></header><article><blockquote><p>文名は容易に揚らず、生活リズムは日を逐うて崩れてゆく。
Kotetは漸く焦躁に駆られて来た。
この頃からその容貌も峭刻となり、肉落ち骨秀で、眼光のみ徒らに炯々として、
曾て進士に登第した頃の豊頬の美少年の俤は、何処に求めようもない。
数年の後、貧窮に堪えず、自らの衣食のために遂に節を屈して、再び東へ赴き、
一地方アルバイトを奉ずることになった。
数日の後、公用で旅に出ること叶わず初日にて欠勤した時、遂に発狂した。或夜半、
急に顔色を変えて寝床から起上ると、
<ruby><rb>base64</rb><rt>何か訳の分らぬこと</rt></ruby>を叫びつつそのまま下にとび下りて、
闇の中へ駈出した。彼は二度と戻って来なかった。附近の山野を捜索しても、何の手掛りもない。
その後Kotetがどうなったかを知る者は、誰もなかった。<sup class=footnote-ref id=fnref:1><a href=#fn:1>1</a></sup></p></blockquote><h3 id=ビットマップ画像を手書きしてツイートしよう>ビットマップ画像を手書きしてツイートしよう</h3><p>かなり前に D で ビットマップ形式の画像を生成するプログラムを書いた記憶がある。
その時のソースコードは残っていないが、けっこう単純なフォーマットだった。
ひょっとしたら全くコンピューターに頼らずに同じことができるのではないかと思い立った。
というわけで画像を手書きしていく。</p><p>目標は次の3つである。</p><ol><li>ビットマップ画像を紙とペンを使って生成</li><li>できたバイナリを紙とペンを使って base64 でエンコード</li><li><a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/Data_URIs>Data URL</a>
としてスマートフォンのキーボードを使ってTwitterに投稿</li></ol><p>特殊なものは使わない。
誰でも持っている道具だけで画像をツイートしてみる。</p><h3 id=ツイートできる最大サイズ>ツイートできる最大サイズ</h3><p>この方式でツイートできる画像の大きさはどれくらいになるだろうか?
まず、出てくる文字はすべて ASCII の範囲内なので文字数制限は280文字と考えていいだろう。
ここから画像データに使えない領域を引いていく。</p><p>まず、Data URL なので最初の <code>data:image/bmp;base64,</code> は必須である。
これでまず22文字引かれる。
残りは258文字となる。</p><p>base64 エンコードを行うため、文字数に対して表現できるバイト数は4分の3になる。
また、base64 文字数を4の倍数にするためのパディングが必要になる。
したがって残りの文字数で表現できるデータ量は192バイトとなる。</p><p>まず必要になるのが画像のヘッダ領域だが、これはフォーマットの選択によって減らすことができる。
しかし頑張って作ったのにビューアが対応してなくて表示できなかったりすると悲しいので、
全部で54バイト必要なWindows形式を採用した。
残りは138バイトである。</p><p>最後にビットマップ、画像データである。
これも形式を選択したり圧縮したりで画素あたりのデータ量をかなり減らすことができるのだが、
これもなんかめんどくさいので一般的な1画素あたり24ビット = 3バイトを選択しよう (ズボラ)。
138を3で割ると46となるので、この条件でツイートできる画像の最大画素数は46である。
ただし行を4バイト境界でアラインする必要があるので、横幅によっては大きなロスが発生する。
それも考慮して、現実的に画像として使える縦横比のものを探すと横4ピクセル、
縦11ピクセルの44画素くらいになるだろう。</p><h3 id=画像の作成>画像の作成</h3><p>というわけで画像 (のバイト列) を作っていく。
今回作るのはこの縦横2ピクセルの画像である。
左上から順に赤 (#FF0000)、緑 (#00FF00)、青 (#0000FF)、白 (#FFFFFF) で塗ってある。
最初はがんばって絵を書こうとしたが、画像が大きくなるに従って計算ミスも増えてくるのでしかたない。</p><p><img src=/assets/2018/08/bitmap.svg alt=お題></p><h4 id=ファイルヘッダー>ファイルヘッダー</h4><h5 id=ファイルタイプ>ファイルタイプ</h5><p>必ず先頭に<code>BM</code>の2文字が入る。
<code>A</code>が0x41であるということさえ覚えておけば計算できるだろう。</p><pre><code>42 4D
</code></pre><h5 id=ファイルサイズ>ファイルサイズ</h5><p>ファイル全体のバイト数。
32ビット整数。
変な数値を入れても入れなくてもまともなビューアーはよしなに表示してくれるらしい。
ノートに余白を設けておいて最後に計算するといいだろう。</p><p>今回は70バイトだったので<code>00 00 00 46</code>(<code>00000000 00000000 00000000 01000110</code>)である。
リトルエンディアンにしなければならないので実際のバイト列はこれを反転したものになる。
今回255を超える数値は登場しないので、何も考えずに数値の後ろにゼロを連ねるだけで良くて非常に楽。</p><pre><code>46 00 00 00
</code></pre><h5 id=予約領域>予約領域</h5><p>2バイトの予約領域が2つある。
ここはゼロ埋めしなければならない。</p><pre><code>00 00 00 00
</code></pre><h5 id=画像データまでのオフセット>画像データまでのオフセット</h5><p>画像データが何バイトめから始まるかを書く。
これも32ビット整数。
ヘッダのバイト数である54 = 0x36を書いたが、これでよかったのだろうか?</p><pre><code>36 00 00 00
</code></pre><h4 id=情報ヘッダー>情報ヘッダー</h4><h5 id=情報ヘッダーのサイズ>情報ヘッダーのサイズ</h5><p>Windows 式なので40バイト。
これも32ビット整数。</p><pre><code>28 00 00 00
</code></pre><h5 id=画像サイズ>画像サイズ</h5><p>ピクセル数。
幅、高さの順番にどちらも符号付き32ビット整数。
高さは通常正の数にするが、負にすると上下が反転して
<a href=#画像データ>後述する</a>
画像データの並びがわかりやすくなるらしい。
わざわざ負数にして計算ミスを起こしたくないし、変なことして表示されなかったら悲しいので、
ここはお行儀よくしておく。</p><pre><code>02 00 00 00
02 00 00 00
</code></pre><h5 id=プレーン数>プレーン数</h5><p>これは16ビット整数。
「ターゲット・デバイスのプレーンの枚数」らしいが、1で固定である。
何を想定しているんだろうか。</p><pre><code>01 00
</code></pre><h5 id=色ビット数>色ビット数</h5><p>1画素を表現するのに使うビット数。
これも16ビット整数。
0 (プリンター等で使う)、1、4、8、16 (「正式に対応していない」らしい)、24、32から選ぶことができる。
今回は一般的な8ビット×3の24ビット。</p><pre><code>18 00
</code></pre><h5 id=圧縮形式>圧縮形式</h5><p>条件によってはちょっとした圧縮をかけることができるらしい。
32ビット整数。</p><p>今回小さな画像を作っているのでバイト列にゼロが多い。
しかし大きい画像の場合はファイルサイズなど32ビット整数でないと不十分なときもあるだろう。
それを考慮してもこの項目は今までで一番ムダにスペースをとっているように思える。
4億通りも圧縮形式の選択肢ができるものだろうか?
余ったビットに圧縮に必要な情報でも入れるのだろうか。</p><p>今回は色ビット数に24を指定してしまったので0 (無圧縮) 1択である。
ビットマップのくせに圧縮なんて生意気なんだよ (暴言)</p><pre><code>00 00 00 00
</code></pre><h5 id=その他>その他</h5><p>この後にも画像データサイズ、解像度、パレット数、重要色数と項目が続いているが、今回の場合はすべてゼロでいい。
5項目すべて32ビット整数。</p><pre><code>00 00 00 00
00 00 00 00
00 00 00 00
00 00 00 00
00 00 00 00
</code></pre><h4 id=画像データ>画像データ</h4><p>いよいよ絵を<strong>書いて</strong>いく。
いくつか注意点がある。
まず画像は下から上に向かって描画されていく。
したがって行は上下反転した順番に並ぶ。
次に、行は4バイトの境界でアラインされている必要がある。
今回は1行が24ビット×2=6バイトになっているので、2バイトのパディングを入れてやらなければならない。
最後に、色の並び順は RGB ではなく BGR である。</p><pre><code>FF 00 00 FF FF FF 00 00
00 00 FF 00 FF 00 00 00
</code></pre><h3 id=base64でエンコード>base64でエンコード</h3><p>以上でバイナリデータが完成したので、base64にしていく。
参考までにここまでで作ってきたビットマップ画像の全体を載せておく。</p><pre><code>42 4D
46 00 00 00
00 00 00 00
36 00 00 00
28 00 00 00
02 00 00 00
02 00 00 00
01 00
18 00
00 00 00 00
00 00 00 00
00 00 00 00
00 00 00 00
00 00 00 00
00 00 00 00
FF 00 00 FF FF FF 00 00
00 00 FF 00 FF 00 00 00
</code></pre><p>base64はASCIIの文字だけを使ってバイナリデータを表現するフォーマットである。
6ビットを1文字で表現するため、データ量としては3分の4に増えることになる。</p><h4 id=3バイトごとに区切る>3バイトごとに区切る</h4><p>上のバイト列から毎回6ビットごと切り出して変換していくのは大変に辛そうなので、
lcm(6,8) = 24ビット = 3バイトごとのブロックに分けて変換していく。
上のバイト列を3バイトごとに改行するようにしたのがこちらである。</p><pre><code>42 4D 46
00 00 00
00 00 00
00 36 00
00 00 28
00 00 00
02 00 00
00 02 00
00 00 01
00 18 00
00 00 00
00 00 00
00 00 00
00 00 00
00 00 00
00 00 00
00 00 00
00 00 00
FF 00 00
FF FF FF
00 00 00
00 FF 00
FF 00 00
00
</code></pre><p><code>00 00 00</code>が多くて楽そうだ。
というわけで変換していく。</p><h4 id=ブロックの変換>ブロックの変換</h4><p>最初の<code>42 4D 46</code>を変換してみる。
まずはバイト列を2進数に直してみる。
元が16進数なので1文字づつ置き換えていけばいい。</p><pre><code>0100 0010 0100 1101 0100 0110
</code></pre><p>次にこれを6ビットごとに区切る。</p><pre><code>010000 100100 110101 000110
</code></pre><p>ひとつづつ変換していく。
ビット列と文字の対応は大文字、小文字、数値、+、/ という並びになっており規則性があるが、
毎回計算すると (少なくとも自分は) 必ずミスをするので
<a href=https://ja.wikipedia.org/wiki/Base64>Wikipedia</a>の対応表などをしっかり見ながらやろう。
すると3バイトのブロックが以下のように4文字にエンコードされる。</p><pre><code>Qk1G
</code></pre><h4 id=最後の処理>最後の処理</h4><p>一番最後の1バイトが仲間を作れないでいる。
ここでは上に加えて特別な処理が必要になる。</p><p>まず2進数にして6ビットごとに区切ってみる。</p><pre><code>000000 00
</code></pre><p>余った2ビットの後ろに0を続けて、6ビットに揃える。</p><pre><code>000000 000000
</code></pre><p>そして同じように変換する。</p><pre><code>AA
</code></pre><p>これで終わりではない。
文字列の長さが4の倍数になるように<code>=</code>でパディングをしてやる必要がある。
ここまでブロックを4文字に変換してきたので、ここも4文字になるようにしてやればいい。</p><pre><code>AA==
</code></pre><p>というわけでできた文字列がこちらになる。</p><pre><code>Qk1GAAAAAAAAADYAAAAoAAAAAgAAAAIAAAABABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wAA////AAAAAP8A/wAAAA==
</code></pre><p>ちゃんと画像になっているかテストしてみよう。
Arch Linuxの場合<code>base64</code>というコマンドが
<a href=https://www.archlinux.org/packages/core/x86_64/coreutils/files/>coreutils</a>
の中に入っている。</p><pre><code class=language-console>$ echo &quot;Qk1GAAAAAAAAADYAAAAoAAAAAgAAAAIAAAABABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wAA////AAAAAP8A/wAAAA==&quot; | base64 -d &gt; test.bmp
</code></pre><h3 id=完成-そしてツイート>完成、そしてツイート</h3><p><img src=/assets/2018/08/bitmap.png alt=ノート width=400></p><p>ノート1ページ (と複数の失敗ページ) の計算の結果、base64にエンコードされたビットマップ画像が完成した。
後は<code>data:image/bmp;base64,</code>をくっつけてツイートするだけだ。</p><p><blockquote class=twitter-tweet data-lang=en><p lang=tl dir=ltr>data:image/bmp;base64,Qk1GAAAAAAAAADYAAAAoAAAAAgAAAAIAAAABABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wAA////AAAAAP8A/wAAAA==</p>&mdash; Kotet (@kotetttt) <a href="https://twitter.com/kotetttt/status/1031647349838241792?ref_src=twsrc%5Etfw">August 20, 2018</a></blockquote><script async src=https://platform.twitter.com/widgets.js></script></p><p>完成した画像を下に貼っておく。
たった4ドットだが、たしかにそこにある。</p><p><img src="data:image/bmp;base64,Qk1GAAAAAAAAADYAAAAoAAAAAgAAAAIAAAABABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wAA////AAAAAP8A/wAAAA==" alt=画像></p><h3 id=参考>参考</h3><ul><li><a href=http://www.umekkii.jp/data/computer/file_format/bitmap.cgi>Bitmapファイルフォーマット</a></li><li><a href=http://www5d.biglobe.ne.jp/~noocyte/Programming/Windows/BmpFileFormat.html>BMPファイルのフォーマット</a></li></ul><div class=footnotes><hr><ol><li id=fn:1><a href=https://www.aozora.gr.jp/cards/000119/files/624_14544.html>中島敦 山月記</a>
<a class=footnote-return href=#fnref:1><sup>[return]</sup></a></li></ol></div></article><footer><h2><a href=/tags/tech>#tech</a>
紙とペンでビットマップ画像を生成してbase64としてツイート</h2><p><time>2018-08-21</time>
<a href=/tags/tech>#tech</a></p></footer><div class=ad-wrapper><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-8443812672116269 data-ad-slot=2914874272 data-ad-format=horizontal data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div></main><footer class=site></footer></body></html>