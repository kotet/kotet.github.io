<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=description content="dpp というパッケージが登場し、使った人の好意的な声をよく聞くようになった。 自分はいまのところ C と連携するようなプログラムを書く予定はないが、 興"><link rel=stylesheet href=https://blog.kotet.jp/sass/single.min.de28e1c7c877cf440b6a52e3e8b5f74662b06e59118c733f331f2b91331dfc39.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/d.min.js></script><script>hljs.initHighlightingOnLoad();</script><script defer src="//cdn.rawgit.com/mathjax/MathJax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type=text/javascript></script><script type=text/x-mathjax-config>
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        displayMath: [['$$','$$']],
        processEscapes: true
      }
    });
</script><title>#dlang dppでCのヘッダファイルを自動変換 - Kotet&#39;s Personal Blog</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel=canonical href=https://blog.kotet.jp/2018/08/dpp/><link rel=icon href=/favicon.ico><meta name=twitter:card content=summary><meta name=og:title content="#dlang dppでCのヘッダファイルを自動変換 - Kotet's Personal Blog"><meta name=og:description content="dpp というパッケージが登場し、使った人の好意的な声をよく聞くようになった。 自分はいまのところ C と連携するようなプログラムを書く予定はないが、 興"><meta name=twitter:image content=https://blog.kotet.jp/assets/logo.png><meta name=twitter:url content=https://blog.kotet.jp/2018/08/dpp/><meta name=twitter:site content=@kotetttt><meta name=twitter:creator content=@kotetttt><meta name=generator content="Hugo 0.51"><script defer src="//www.googletagmanager.com/gtag/js?id=UA-88180620-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-88180620-1');</script><script async src=//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><script>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:"ca-pub-8443812672116269",enable_page_level_ads:true});</script></head><body><header class=site><nav><ul><li><a href=/about>ABOUT</a></li><li><a href=/products>PRODUCTS</a></li><li><a href=/tags>TAGS</a></li><li><a href=/index.xml>FEED</a></li></ul></nav><h1><a href=/>KOTET'S<br>PERSONAL<br>BLOG</a></h1></header><main><header><h2><a href=/tags/dlang>#dlang</a>
dppでCのヘッダファイルを自動変換</h2><p><time>2018-08-08</time>
<a href=/tags/dlang>#dlang</a> <a href=/tags/tech>#tech</a> <a href=/tags/log>#log</a></p><aside><p>Table of Contents</p><nav id=TableOfContents><ul><li><ul><li><ul><li><a href=#d-include-c-and-c-headers-in-d-files>d++ - #include C and C++ headers in D files</a></li><li><a href=#使ってみる>使ってみる</a><ul><li><a href=#c-h>c.h</a></li><li><a href=#c-c>c.c</a></li><li><a href=#foo-dpp>foo.dpp</a></li></ul></li><li><a href=#他にも試してみる>他にも試してみる</a><ul><li><a href=#app-dpp>app.dpp</a></li></ul></li><li><a href=#c>C++</a></li></ul></li></ul></li></ul></nav></aside></header><article><p>dpp というパッケージが登場し、使った人の好意的な声をよく聞くようになった。
自分はいまのところ C と連携するようなプログラムを書く予定はないが、
興味が出たので使ってみることにした。</p><h3 id=d-include-c-and-c-headers-in-d-files>d++ - #include C and C++ headers in D files</h3><p>D言語で書かれたプログラムは C のプログラムと互換性があり、リンクすることができる。
しかしそのためにはヘッダファイルを変換した D プログラムを用意する必要があり、
それが手間である。
ここを自動化できればとても嬉しく、D言語くんのO脚も治る(慣用句)。</p><p>dpp はそのためのソフトウェアである。</p><p><a href=https://code.dlang.org/packages/dpp>Package dpp version 0.0.2 - DUB - The D package registry</a></p><h3 id=使ってみる>使ってみる</h3><p>さっそくREADMEの例を試してみる。</p><h4 id=c-h>c.h</h4><pre><code class=language-c>#ifndef C_H
#define C_H

#define FOO_ID(x) (x*3)

int twice(int i);

#endif
</code></pre><h4 id=c-c>c.c</h4><pre><code class=language-c>int twice(int i) { return i * 2; }
</code></pre><h4 id=foo-dpp>foo.dpp</h4><pre><code>#include &quot;c.h&quot;
void main() {
    import std.stdio;
    writeln(twice(FOO_ID(5)));  // yes, it's using a C macro here!
}
</code></pre><p>D プログラムの拡張子は<code>.dpp</code>にする。
C と同じように<code>#include</code>してやる。
D のフォーマッター等が動かなくなるのがちょっとつらい。</p><p>dpp は<code>.dpp</code>ファイルを<code>.d</code>プログラムに変換して dmd などに渡すラッパーである。
READMEではビルドしてできる<code>d++</code>という実行ファイルを使っているが、
<code>dub run</code>でも動かせる。
clang をインストールしておく必要があるので注意。</p><pre><code class=language-console>$ dub fetch dpp
Fetching dpp 0.0.2...
Please note that you need to use `dub run &lt;pkgname&gt;` or add it to dependencies of your package to actually use/run it. dub does not do actual installation of packages outside of its own ecosystem.
$ dub run dpp -- foo.dpp c.o
Building package dpp in /home/kotet/.dub/packages/dpp-0.0.2/dpp/
Package unit-threaded can be upgraded from 0.7.46 to 0.7.47.
Package libclang can be upgraded from 0.0.6 to 0.0.7.
Use &quot;dub upgrade&quot; to perform those changes.
Performing &quot;debug&quot; build using /usr/bin/dmd for x86_64.
libclang 0.0.6: target for configuration &quot;library&quot; is up to date.
dpp 0.0.2: target for configuration &quot;executable&quot; is up to date.
To force a rebuild of up-to-date targets, run again with --force.
Running ../../.dub/packages/dpp-0.0.2/dpp/bin/d++ foo.dpp c.o
$ ./foo 
30
</code></pre><p><code>c.d</code> を書かずに C プログラムのリンクができた。</p><h3 id=他にも試してみる>他にも試してみる</h3><p>すでに<code>stdio.h</code>など複数のヘッダファイルが完全に変換できるようになっているらしい。
以前やった
<a href=/2017/04/use-c-stdio-in-d>C の標準ライブラリの利用</a>
と同じことを dpp でやってみる。</p><h4 id=app-dpp>app.dpp</h4><pre><code>#include &quot;/usr/include/stdio.h&quot;
import std.string : toStringz;

void main()
{
	puts(&quot;hello&quot;.toStringz);
}
</code></pre><p>C の標準ライブラリは自動的にリンクされるので<code>app.dpp</code>だけを渡せばいい。</p><pre><code class=language-console>$ dub run dpp -- app.dpp
Building package dpp in /home/kotet/.dub/packages/dpp-0.0.2/dpp/
Package unit-threaded can be upgraded from 0.7.46 to 0.7.47.
Package libclang can be upgraded from 0.0.6 to 0.0.7.
Use &quot;dub upgrade&quot; to perform those changes.
Performing &quot;debug&quot; build using /usr/bin/dmd for x86_64.
libclang 0.0.6: target for configuration &quot;library&quot; is up to date.
dpp 0.0.2: target for configuration &quot;executable&quot; is up to date.
To force a rebuild of up-to-date targets, run again with --force.
Running ../../../.dub/packages/dpp-0.0.2/dpp/bin/d++ app.dpp
$ ./app
hello
</code></pre><p>今回の場合は必要な行数が変わってないのであまりうまみがないが、
そうでない状況があることは容易に想像できる。</p><h3 id=c>C++</h3><p>dpp は今のところ C のヘッダーファイルにしか対応していないが、
将来的には C++ のヘッダーファイルへの対応も予定しているそうだ。
まだバージョン 0.0.2 で問題も多いが、使えるようになれば
D を使った開発がより簡単になると思うのでうまくいくといいなと思った。</p></article><footer><h2><a href=/tags/dlang>#dlang</a>
dppでCのヘッダファイルを自動変換</h2><p><time>2018-08-08</time>
<a href=/tags/dlang>#dlang</a> <a href=/tags/tech>#tech</a> <a href=/tags/log>#log</a></p></footer><div class=ad-wrapper><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-8443812672116269 data-ad-slot=2914874272 data-ad-format=horizontal data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div></main><footer class=site></footer></body></html>